{"version":3,"sources":["../../controllers/realtyController.js"],"names":["getRealty","req","res","send","knex","leftJoin","select","orderBy","err","status","message","getByIdRealty","where","id","params","createRealty","owner_id","address","number_address","body","insert","updateRealty","update","fn","now","deleteRealty","resident","from","length","token","headers","authorization","split","jwt","decode","admin","delete"],"mappings":"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","sourcesContent":["const getRealty = async (req, res) => {\r\n    try {\r\n        res.send(await knex('realtys').leftJoin('residents', 'realtys.owner_id', 'residents.id').select('residents.name', 'realtys.address', 'realtys.id', 'realtys.number_address').orderBy('realtys.updated_at', 'desc'))\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n\r\n}\r\n\r\nconst getByIdRealty = async (req, res) => {\r\n    try {\r\n        res.send(await knex('realtys').leftJoin('residents', 'realtys.owner_id', 'residents.id').select('residents.name', 'realtys.address', 'realtys.id', 'realtys.number_address').where({ id: req.params.id }))\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst createRealty = async (req, res) => {\r\n    const { owner_id, address, number_address } = req.body\r\n\r\n    if (!address || !number_address) return res.status(400).send({ message: 'Por favor preencha todos os campos' })\r\n\r\n    try {\r\n        await knex('realtys').insert(req.body)\r\n        res.send({ message: \"Imóvel cadastrado com sucesso!\" })\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst updateRealty = async (req, res) => {\r\n\r\n    try {\r\n        await knex('realtys').where({ id: req.params.id }).update(req.body).update('updated_at', knex.fn.now())\r\n        res.send({ message: \"Atualizado com sucesso!\" })\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst deleteRealty = async (req, res) => {\r\n    try {\r\n        let resident = await knex.select('id').from('realtys').where({ id: req.params.id })\r\n        if (!resident.length) return res.status(404).send({ message: \"Usuário não encontrado\" })\r\n        let token = req.headers.authorization.split(\" \")[1]\r\n        if (jwt.decode(token).admin === 0) return res.status(401).send({ message: \"Usuário não tem permissões para exclusão\" })\r\n\r\n        await knex('realtys').where({ id: req.params.id }).delete()\r\n        res.send({ message: \"Excluido com sucesso!\" })\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nexport { getRealty, getByIdRealty, createRealty, updateRealty, deleteRealty }\r\n"],"file":"realtyController.js"}