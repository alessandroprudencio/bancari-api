{"version":3,"sources":["../../controllers/residentController.js"],"names":["getResident","req","res","send","knex","select","from","err","status","message","getByIdResident","where","id","params","createResident","name","email","address","phone","number_address","body","validator","isEmail","insert","code","updateResident","update","fn","now","deleteResident","resident","length","token","headers","authorization","split","jwt","decode","admin","delete"],"mappings":"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","sourcesContent":["const getResident = async (req, res) => {\r\n    try {\r\n        res.send(await knex.select('id', 'name', 'email', 'address', 'phone', 'number_address').from('residents'))\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst getByIdResident = async (req, res) => {\r\n    try {\r\n        res.send(await knex.select('id', 'name', 'email', 'address', 'phone', 'number_address').from('residents').where({ id: req.params.id }))\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst createResident = async (req, res) => {\r\n    const { name, email, address, phone, number_address } = req.body\r\n\r\n    if (!name || !email || !address || !phone || !number_address) return res.status(400).send({ message: 'Por favor preencha todos os campos' })\r\n\r\n    if (email && !validator.isEmail(email)) return res.status(400).send({ message: 'E-mail inválido' })\r\n\r\n    try {\r\n        await (knex('residents').insert(req.body))\r\n        res.send({ message: \"Morador cadastrado com sucesso!\" })\r\n    } catch (err) {\r\n        if (err.code == \"ER_DUP_ENTRY\") res.status(400).send({ message: 'Email já cadastrado!' })\r\n        res.status(500).send({ message: err })\r\n    }\r\n}\r\n\r\nconst updateResident = async (req, res) => {\r\n\r\n    try {\r\n        await knex('residents').where({ id: req.params.id }).update(req.body).update('updated_at', knex.fn.now())\r\n        res.send({ message: \"Atualizado com sucesso!\" })\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n\r\n}\r\n\r\nconst deleteResident = async (req, res) => {\r\n\r\n    try {\r\n        let resident = await knex.select('id').from('residents').where({ id: req.params.id })\r\n        if (!resident.length) return res.status(404).send({ message: \"Usuário não encontrado\" })\r\n\r\n        let token = req.headers.authorization.split(\" \")[1]\r\n        if (jwt.decode(token).admin === 0) return res.status(401).send({ message: \"Usuário não tem permissões para exclusão\" })\r\n\r\n        await knex('residents').where({ id: req.params.id }).delete()\r\n        res.send({ message: \"Excluido com sucesso!\" })\r\n    } catch (err) {\r\n        res.status(500).send({ message: err })\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\nexport { getResident, getByIdResident, createResident, updateResident, deleteResident }\r\n"],"file":"residentController.js"}